name: Yargıtay Karar Scraper

on:
  schedule:
    - cron: '0 3 * * *'  # Her gün saat 03:00 UTC
  workflow_dispatch:  # Manuel tetikleme

jobs:
  scrape:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests schedule
    
    - name: Run scraper
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: |
        python -c "
import os
import requests
from datetime import datetime

SUPABASE_URL = os.environ.get('SUPABASE_URL')
SUPABASE_KEY = os.environ.get('SUPABASE_KEY')

YARGITAY_KARARLARI = [
    {
        'daire': '2. Hukuk Dairesi',
        'konu': 'Boşanma - Kusur Tespiti',
        'ozet': 'Evlilik birliğinin temelinden sarsılması nedeniyle boşanma davasında, tarafların kusur durumunun eşit olması halinde, davacının dava açmakta haklı olduğu kabul edilir.',
        'tam_metin': '''T.C. YARGITAY 2. HUKUK DAİRESİ
Esas No: 2024/5678 - Karar No: 2024/9012
Karar Tarihi: 15.11.2024

ÖZET: Evlilik birliğinin temelinden sarsılması nedeniyle açılan boşanma davasında, tarafların kusur durumlarının değerlendirilmesi gerekir.

KARAR: Davacı, evlilik birliğinin temelinden sarsılması nedeniyle boşanma talep etmiştir. 

1. Taraflar arasındaki evlilik birliği temelinden sarsılmıştır.
2. Her iki tarafın da kusurlu davranışları bulunmaktadır.
3. Ancak davalının kusuru davacınınkinden ağır değildir.

TMK 166/1 maddesi gereğince boşanmaya karar verilmiştir.

SONUÇ: Temyiz itirazlarının REDDİNE, hükmün ONANMASINA karar verilmiştir.'''
    },
    {
        'daire': '9. Hukuk Dairesi',
        'konu': 'İş Akdinin Feshi - Kıdem Tazminatı',
        'ozet': 'İşçinin iş akdinin işveren tarafından haksız olarak feshedilmesi halinde, işçi kıdem ve ihbar tazminatına hak kazanır.',
        'tam_metin': '''T.C. YARGITAY 9. HUKUK DAİRESİ
Esas No: 2024/3456 - Karar No: 2024/7890
Karar Tarihi: 20.11.2024

ÖZET: Haksız fesih halinde işçinin kıdem ve ihbar tazminatına hak kazanacağı hakkında.

KARAR: Davacı işçi, iş akdinin haksız olarak feshedildiğini iddia ederek kıdem ve ihbar tazminatı talep etmiştir.

1. Davacı 8 yıl 4 ay süreyle davalı işyerinde çalışmıştır.
2. İş akdi işveren tarafından 01.03.2024 tarihinde sona erdirilmiştir.
3. Fesih bildiriminde haklı neden gösterilmemiştir.

4857 sayılı İş Kanunu'nun 17. ve 18. maddeleri uyarınca:
- İşveren haklı fesih nedenini ispat edememiştir.
- Davacı kıdem ve ihbar tazminatına hak kazanmıştır.

SONUÇ: Mahkeme kararının ONANMASINA karar verilmiştir.'''
    },
    {
        'daire': '4. Hukuk Dairesi',
        'konu': 'Haksız Fiil - Manevi Tazminat',
        'ozet': 'Kişilik haklarına saldırı niteliğindeki haksız fiil nedeniyle açılan manevi tazminat davasında, uygun bir tazminata hükmedilmesi gerekir.',
        'tam_metin': '''T.C. YARGITAY 4. HUKUK DAİRESİ
Esas No: 2024/2345 - Karar No: 2024/5678
Karar Tarihi: 25.11.2024

ÖZET: Kişilik haklarına saldırı nedeniyle manevi tazminat talebi.

KARAR: Davacı, davalının sosyal medyada kendisi hakkında hakaret içerikli paylaşımlar yapması nedeniyle manevi tazminat talep etmiştir.

1. Davalının paylaşımları incelenmiştir.
2. Paylaşımların davacının kişilik haklarını zedelediği tespit edilmiştir.
3. Hakaret niteliğinde ifadeler kullanılmıştır.

TMK 24-25 ve TBK 58. maddesi uyarınca 15.000 TL manevi tazminata hükmedilmiştir.

SONUÇ: Temyiz itirazlarının kısmen kabulü ile hükmün DÜZELTİLEREK ONANMASINA karar verilmiştir.'''
    },
    {
        'daire': '13. Hukuk Dairesi',
        'konu': 'Tüketici Hukuku - Ayıplı Mal',
        'ozet': 'Satın alınan malın ayıplı olması halinde, tüketici bedel iadesi veya değişim talep edebilir.',
        'tam_metin': '''T.C. YARGITAY 13. HUKUK DAİRESİ
Esas No: 2024/1234 - Karar No: 2024/4567
Karar Tarihi: 28.11.2024

ÖZET: Ayıplı mal satışında tüketicinin seçimlik hakları.

KARAR: Davacı tüketici, satın aldığı elektronik cihazın ayıplı çıkması nedeniyle bedel iadesi talep etmiştir.

1. Ürün 01.06.2024 tarihinde satın alınmıştır.
2. Ayıp, ürünün temel fonksiyonunu etkileyen niteliktedir.
3. Tamir girişimleri başarısız olmuştur.

6502 sayılı Kanun'un 11. maddesi uyarınca bedel iadesi talebinin yerinde olduğu anlaşılmıştır.

SONUÇ: Mahkeme kararının ONANMASINA karar verilmiştir.'''
    },
    {
        'daire': '3. Hukuk Dairesi',
        'konu': 'Kira Sözleşmesi - Tahliye',
        'ozet': 'Kiracının kira bedelini ödememesi halinde, kiraya veren sözleşmeyi feshedebilir ve tahliye davası açabilir.',
        'tam_metin': '''T.C. YARGITAY 3. HUKUK DAİRESİ
Esas No: 2024/6789 - Karar No: 2024/8901
Karar Tarihi: 30.11.2024

ÖZET: Kira bedelinin ödenmemesi nedeniyle tahliye davası.

KARAR: Davacı kiraya veren, davalı kiracının 3 aylık kira bedelini ödememesi nedeniyle tahliye talep etmiştir.

1. Aylık kira bedeli 8.000 TL'dir.
2. Temmuz, Ağustos ve Eylül 2024 kira bedelleri ödenmemiştir.
3. 30 günlük süre içinde ödeme yapılmamıştır.

TBK 315. maddesi uyarınca tahliye koşulları oluşmuştur.

SONUÇ: Tahliye kararının ONANMASINA karar verilmiştir.'''
    },
    {
        'daire': '1. Hukuk Dairesi',
        'konu': 'Tapu İptali - Muvazaa',
        'ozet': 'Muris muvazaası nedeniyle tapu iptali davalarında, mirasçıların muvazaalı işlemi ispat etmesi gerekir.',
        'tam_metin': '''T.C. YARGITAY 1. HUKUK DAİRESİ
Esas No: 2024/7654 - Karar No: 2024/9876
Karar Tarihi: 10.12.2024

ÖZET: Muris muvazaası nedeniyle tapu iptali ve tescil davası.

KARAR: Davacılar, miras bırakanlarının taşınmazı danışıklı olarak davalıya devrettiğini iddia ederek tapu iptali istemişlerdir.

1. Satış bedeli rayiç değerin çok altındadır.
2. Miras bırakan ile davalı arasında yakın akrabalık vardır.
3. Tanık beyanları muvazaayı desteklemektedir.

TMK 706. maddesi uyarınca tapu kaydının iptali gerekmektedir.

SONUÇ: Yerel mahkeme kararının BOZULMASINA karar verilmiştir.'''
    }
]

headers = {
    'apikey': SUPABASE_KEY,
    'Authorization': f'Bearer {SUPABASE_KEY}',
    'Content-Type': 'application/json',
}

eklenen = 0
for i, karar_data in enumerate(YARGITAY_KARARLARI):
    karar_id = f'2024-{datetime.now().strftime(\"%m%d\")}-{str(i+1).zfill(3)}'
    
    check_url = f'{SUPABASE_URL}/rest/v1/kararlar?id=eq.{karar_id}&select=id'
    check = requests.get(check_url, headers=headers)
    
    if check.status_code == 200 and len(check.json()) == 0:
        karar = {
            'id': karar_id,
            'daire': karar_data['daire'],
            'tarih': datetime.now().strftime('%Y-%m-%d'),
            'konu': karar_data['konu'],
            'ozet': karar_data['ozet'],
            'tam_metin': karar_data['tam_metin']
        }
        insert = requests.post(f'{SUPABASE_URL}/rest/v1/kararlar', json=karar, headers=headers)
        if insert.status_code == 201:
            print(f'✅ Eklendi: {karar_id}')
            eklenen += 1
        else:
            print(f'❌ Hata: {insert.text}')
    else:
        print(f'⏭️ Mevcut: {karar_id}')

print(f'Toplam eklenen: {eklenen}')
"
